<!DOCTYPE html>
<html>

<head>
    <title>Mijn Bank</title>
    <style>
        body {
            font-family: Arial;
            max-width: 900px;
            margin: 40px auto;
        }

        .card {
            border: 1px solid #ddd;
            padding: 16px;
            margin-bottom: 16px;
        }

        button {
            padding: 8px 12px;
        }

        input {
            padding: 8px;
            width: 100%;
            margin: 6px 0;
        }

        .grid {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .grid>div {
            flex: 1;
            min-width: 280px;
        }

        pre {
            background: #f6f8fa;
            padding: 10px;
            overflow: auto;
        }

        .bad {
            border-left: 6px solid #d33;
        }

        .good {
            border-left: 6px solid #2a8;
        }
    </style>
</head>

<body>
    <h1>Mijn Bank</h1>
    <div class="card">
        <h3>1) Login</h3>
        <p>Simulatie: klik login, de server zet een sessie-cookie
            <code>sid</code>.
        </p>
        <button id="login">Login</button>
        <span id="loginState"></span>
    </div>
    <div class="grid">
        <div class="card bad">
            <h3>2) Transfer (KWETSBAAR, geen CSRF token)</h3>
            <form id="vulnForm">
                <input name="to" value="attacker">
                <input name="amount" value="1000">
                <button>Verstuur (vulnerable)</button>
            </form>
            <pre id="vulnResult"></pre>
        </div>
        <div class="card good">
            <h3>3) Transfer (PROTECTED, met CSRF token)</h3>
            <form id="safeForm">
                <input name="to" value="attacker">
                <input name="amount" value="1000">
                <input name="csrf" id="csrf" placeholder="csrf token (auto gevuld)">
                <button>Verstuur (protected)</button>
            </form>
            <pre id="safeResult"></pre>
        </div>
    </div>
    85
    <div class="card">
        <h3>4) Account overzicht</h3>
        <button id="refresh">Refresh account</button>
        <pre id="me"></pre>
    </div>
    <script>
        const loginBtn = document.getElementById("login");
        const refreshBtn = document.getElementById("refresh");
        const loginState = document.getElementById("loginState");
        const vulnForm = document.getElementById("vulnForm");
        const safeForm = document.getElementById("safeForm");
        const vulnResult = document.getElementById("vulnResult");
        const safeResult = document.getElementById("safeResult");
        const mePre = document.getElementById("me");
        const csrfInput = document.getElementById("csrf");
        async function api(path, options) {
            const res = await fetch(path, {
                ...options, headers: {
                    "Content-Type":
                        "application/x-www-form-urlencoded"
                }
            });
            const text = await res.text();
            try { return { ok: res.ok, data: JSON.parse(text) }; } catch {
                return { ok: res.ok, data: text };
            }
        }
        async function refresh() {
            const res = await fetch("/me");
            const text = await res.text();
            mePre.textContent = text;
        }
        async function loadCsrf() {
            const res = await fetch("/csrf-token");
            if (!res.ok) return;
            const json = await res.json();
            csrfInput.value = json.csrfToken;
        }
        loginBtn.addEventListener("click", async () => {
            const res = await fetch("/login", { method: "POST" });
            loginState.textContent = res.ok ? "✅ logged in (cookie gezet)" : "❌ login failed";
            await loadCsrf();
            await refresh();
        });
        refreshBtn.addEventListener("click", refresh);
        vulnForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const body = new URLSearchParams(new FormData(vulnForm)).toString();
            86
            const r = await api("/transfer", { method: "POST", body });
            vulnResult.textContent = JSON.stringify(r.data, null, 2);
            await refresh();
        });
        safeForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const body = new URLSearchParams(new FormData(safeForm)).toString();
            const r = await api("/transfer-protected", { method: "POST", body });
            safeResult.textContent = JSON.stringify(r.data, null, 2);
            await refresh();
        });
        // page load
        refresh();
        loadCsrf();
    </script>
</body>

</html>